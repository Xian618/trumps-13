<% title "Game" %>
<div class="container">
	<div class="row">
		<div class="span12">
            <div align="center">
            <!--
                <h1>Trumps</h1>
                <h4 id="player_count">Players: 1</h4>
                <div id="console" class="well"></div>
                <%= link_to "Switch", {:action => "switch", :id => @game}, :remote => true,
                 :id => 'button', "data-role" => "button", "data-theme" => "b" %>
            -->
                <div class="container">
                    <div class="row">
                        <div class="span6">
                            <h4>Player 1</h4>
                            <%= render 'games/card' %>
                        </div>
                        <div class="span6 hidden-phone">
                            <h4>Player 2</h4>
                            <%= render 'games/card' %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<% content_for :footer do %>
    <div data-role="footer">
        <div data-role="navbar">
            <ul>
                <li><a href="a.html" data-icon="grid">Cards</a></li>
                <li><a href="b.html" data-icon="star">Acheviements</a></li>
                <li><a href="c.html" data-icon="info">Learn More</a></li>
            </ul>
        </div>
    </div> 
<% end %> 

<script type="text/javascript">
    var pusher = new Pusher('d2b29a599cc5f3823b3b');
    var channel = pusher.subscribe('<%= "presence-" + @game.id.to_s %>');

    channel.bind('pusher:subscription_succeeded', function() {
        if (channel.members.count > 1) {
            console('Game on!');
            set_players();
        } else {
            console('Waiting for player 2...');
        }
    });
    channel.bind('switch', function(data) {
        var switchButton = $('#button');
        if (switchButton.attr("data-theme") == 'b') {
            switchButton.buttonMarkup({theme: 'e'});    
        } else {
            switchButton.buttonMarkup({theme: 'b'});
        }
            
    });
    channel.bind('pusher:member_added', function() {
        set_players();
        console('Game on!');
    });


    // Helper Functions    
    function set_players() {
        $('#player_count').text("Players: " + channel.members.count);   
    }

    function console(string) {
        $('#console').text(string);
    }
    
</script> 
